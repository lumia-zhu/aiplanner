<!DOCTYPE html>
<html>
<head>
  <title>æ—¶é—´æ˜¾ç¤ºè¯Šæ–­</title>
  <style>
    body { font-family: monospace; padding: 20px; }
    .section { margin: 20px 0; padding: 10px; border: 1px solid #ccc; }
    .success { color: green; }
    .error { color: red; }
    .info { color: blue; }
  </style>
</head>
<body>
  <h1>æ—¶é—´æ˜¾ç¤ºåŠŸèƒ½è¯Šæ–­</h1>
  
  <div class="section">
    <h2>æ­¥éª¤ 1: æ£€æŸ¥ä»»åŠ¡é¡¹ç»“æ„</h2>
    <button onclick="checkStructure()">è¿è¡Œæ£€æŸ¥</button>
    <pre id="structure-result"></pre>
  </div>
  
  <div class="section">
    <h2>æ­¥éª¤ 2: æ£€æŸ¥å±æ€§æ˜¯å¦å­˜åœ¨</h2>
    <button onclick="checkAttributes()">è¿è¡Œæ£€æŸ¥</button>
    <pre id="attributes-result"></pre>
  </div>
  
  <div class="section">
    <h2>æ­¥éª¤ 3: æ£€æŸ¥ DOM æ’å…¥</h2>
    <button onclick="checkDOMInsertion()">è¿è¡Œæ£€æŸ¥</button>
    <pre id="dom-result"></pre>
  </div>
  
  <div class="section">
    <h2>æ­¥éª¤ 4: æ‰‹åŠ¨æ’å…¥æµ‹è¯•</h2>
    <button onclick="manualInsert()">æ‰‹åŠ¨æ’å…¥æ—¶é—´æ˜¾ç¤º</button>
    <pre id="manual-result"></pre>
  </div>

  <script>
    function checkStructure() {
      const result = document.getElementById('structure-result');
      const editor = document.querySelector('.ProseMirror');
      
      if (!editor) {
        result.textContent = 'âŒ æ‰¾ä¸åˆ°ç¼–è¾‘å™¨';
        result.className = 'error';
        return;
      }
      
      const taskItems = editor.querySelectorAll('li[data-drag-handle]');
      result.textContent = `âœ… æ‰¾åˆ° ${taskItems.length} ä¸ªä»»åŠ¡é¡¹\n\n`;
      
      taskItems.forEach((item, i) => {
        result.textContent += `ä»»åŠ¡ ${i + 1}:\n`;
        result.textContent += `  - æœ‰ data-datetime-mode: ${item.hasAttribute('data-datetime-mode')}\n`;
        result.textContent += `  - mode å€¼: ${item.getAttribute('data-datetime-mode')}\n`;
        result.textContent += `  - æœ‰ data-deadline-time: ${item.hasAttribute('data-deadline-time')}\n`;
        result.textContent += `  - deadline å€¼: ${item.getAttribute('data-deadline-time')}\n`;
        
        const contentDiv = item.querySelector(':scope > div');
        result.textContent += `  - æ‰¾åˆ° contentDiv: ${!!contentDiv}\n`;
        
        if (contentDiv) {
          const badge = contentDiv.querySelector('.task-datetime-badge');
          result.textContent += `  - æ‰¾åˆ° badge: ${!!badge}\n`;
          if (badge) {
            result.textContent += `  - badge å†…å®¹: ${badge.textContent}\n`;
          }
        }
        result.textContent += '\n';
      });
      
      result.className = 'success';
    }
    
    function checkAttributes() {
      const result = document.getElementById('attributes-result');
      const editor = document.querySelector('.ProseMirror');
      const taskItems = editor?.querySelectorAll('li[data-datetime-mode]');
      
      if (!taskItems || taskItems.length === 0) {
        result.textContent = 'âŒ æ‰¾ä¸åˆ°å¸¦æ—¶é—´çš„ä»»åŠ¡é¡¹';
        result.className = 'error';
        return;
      }
      
      result.textContent = `âœ… æ‰¾åˆ° ${taskItems.length} ä¸ªå¸¦æ—¶é—´çš„ä»»åŠ¡\n\n`;
      
      taskItems.forEach((item, i) => {
        result.textContent += `ä»»åŠ¡ ${i + 1}:\n`;
        result.textContent += `  HTML: ${item.outerHTML.substring(0, 200)}...\n\n`;
      });
      
      result.className = 'success';
    }
    
    function checkDOMInsertion() {
      const result = document.getElementById('dom-result');
      const editor = document.querySelector('.ProseMirror');
      const taskItems = editor?.querySelectorAll('li[data-datetime-mode]');
      
      if (!taskItems || taskItems.length === 0) {
        result.textContent = 'âŒ æ‰¾ä¸åˆ°å¸¦æ—¶é—´çš„ä»»åŠ¡é¡¹';
        result.className = 'error';
        return;
      }
      
      let inserted = 0;
      taskItems.forEach((item) => {
        const contentDiv = item.querySelector(':scope > div');
        if (contentDiv) {
          const badge = contentDiv.querySelector('.task-datetime-badge');
          if (badge) {
            inserted++;
          }
        }
      });
      
      result.textContent = `æ£€æŸ¥ç»“æœ:\n`;
      result.textContent += `  - åº”è¯¥æ’å…¥: ${taskItems.length} ä¸ª\n`;
      result.textContent += `  - å®é™…æ’å…¥: ${inserted} ä¸ª\n`;
      
      if (inserted === taskItems.length) {
        result.textContent += '\nâœ… æ‰€æœ‰æ—¶é—´å¾½ç« éƒ½å·²æ’å…¥ï¼';
        result.className = 'success';
      } else {
        result.textContent += '\nâŒ éƒ¨åˆ†å¾½ç« æœªæ’å…¥ï¼';
        result.className = 'error';
      }
    }
    
    function manualInsert() {
      const result = document.getElementById('manual-result');
      const editor = document.querySelector('.ProseMirror');
      const taskItems = editor?.querySelectorAll('li[data-datetime-mode="deadline"]');
      
      if (!taskItems || taskItems.length === 0) {
        result.textContent = 'âŒ æ‰¾ä¸åˆ°å¸¦æ—¶é—´çš„ä»»åŠ¡é¡¹';
        result.className = 'error';
        return;
      }
      
      taskItems.forEach((item) => {
        const contentDiv = item.querySelector(':scope > div');
        if (contentDiv) {
          // æ¸…é™¤æ—§çš„
          const old = contentDiv.querySelector('.manual-test-badge');
          if (old) old.remove();
          
          // æ’å…¥æ–°çš„
          const badge = document.createElement('span');
          badge.className = 'manual-test-badge';
          badge.textContent = ' ğŸŸ¢ æ‰‹åŠ¨æµ‹è¯•';
          badge.style.cssText = 'color: green; font-size: 20px; font-weight: bold;';
          contentDiv.appendChild(badge);
        }
      });
      
      result.textContent = 'âœ… å·²æ‰‹åŠ¨æ’å…¥æµ‹è¯•å¾½ç« ï¼Œè¯·æŸ¥çœ‹ç¼–è¾‘å™¨';
      result.className = 'success';
    }
  </script>
</body>
</html>





